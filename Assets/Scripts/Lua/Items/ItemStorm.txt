require "Assets.Scripts.Lua.Items.Header"
properties = {
	Name =            "Storm"; --物品名
	Type =            ITEM_WEAPEN;
	ShotType =        WEAPON_AUTO;
	EnergyCost =      0;  
	AttackSpeed =     30.0;
	FirePower =       40.0;
	Weight =          15.0;
	Mesh =            "Shell"; --模型文件
	Description = "雷云风暴 自动步枪 攻击有10%几率使投射物附带20%电磁伤害。攻击命中有10%几率使目标麻痹0.5s。消耗30能量，向前方发射一团缓慢移动的电浆。电浆会每隔1.5s向周围随机目标发射能弹射3次，每次伤害50%武器攻击力的连锁闪电，最后爆炸造成400%武器攻击的伤害。(稀有 掉落)";
}

function OnUse(usr)
	local buff = {
		Name = 					"StormPecvd Buff";
		Description = 			"随机攻击附近目标";
	};
    print("Storm Used");
end


function OnUpdate(c,deltaTime)
	local lanchtime = 0;
	lanchtime += deltaTime;
	if lanchtime >= 1.5 then
		for	i = 1,3 do
			local buff1 = {
				Name = 			"eleDamage Buff";
				Description = 	"电浆伤害";
				Stackable = 	false;
				Bonus = {
					{ATTR_MAX_HP, IS_RATIO, - c.GetBonus().ATTR_WEAPON_DAMAGE*0.5};
				};
			};
			--任意方向上，最近的敌人：AddBuff(Buff.CreateBuff(buff1));
		end
		local buff2 ={
			Name  = 			"eleGround Buff";
			Description = 		"落地造成400%武器攻击力伤害";
			Stackable = 		false;
			Bonus = {
				{ATTR_MAX_HP, IS_RATIO, - c.GetBonus().ATTR_WEAPON_DAMAGE*4.0};
			};
		};
		--落地最接近的敌人：AddBuff(Buff.CreateBuff(buff2));

		lanchtime = 0; 
	end 

end

function OnHit(enemy)
	local buff1 = {
		Name = 					"StormDizzy Buff";
		Description = 			"麻痹目标";
		Duration = 				0.5;
		Stackable = 			false;
		OnDamaged = function(inter,damage)
			--修改enemy状态机lostControl的状态的函数调用
		end;
	};
	local buff2 = {
		Name = 					"StormEle Buff";
		Description = 			"电磁伤害+电浆";
		Stackable = 			false;

		Bonus = {
			{ATTR_MAX_HP, IS_RATIO, -20.0}; --20%电磁伤害
			{ATTR_MAX_EN, IS_FIXED, -30.0}; --消耗30点能量
		};
		OnAttach = function(inter)
			--生成电浆
		end

		OnDamage = function(inter,damage)
			--播放电磁的特效
		end;
	};

	--10%的概率加该buff
	local r = math.random(1,10);
	if r == 10 then
		enemy:AddBuff(Buff.CreateBuff(buff1));
	elseif r == 9 then
		--投射物:AddBuff(Buff.CreateBuff(buff2));
	end
end